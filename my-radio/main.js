!function(){"use strict";const t=(t,s)=>{t&&Object.keys(t).forEach(e=>s.setAttribute(e,`${t[e]}`))},s=(t,s)=>{s&&s.appendChild(t)},e=document,i=(i,l=null,n=null)=>{const a=e.createElement(i);return t(n,a),s(a,l),a},l=(i,l=null,n=null)=>{const a=e.createElementNS("http://www.w3.org/2000/svg",i);return t(n,a),s(a,l),a};class n{constructor(){this.load=(({url:t,artist:s,song:e,alt:i})=>fetch(t).then(t=>t.json()).then(t=>{if(!t)return null;let l=this.get(t,s),n=this.get(t,e);if(!l||!n){const s=this.get(t,i),e=(s||"").split(" - ");[l,n]=2===e.length?e:[s,null]}return{title:l,subtitle:n}}).catch(t=>null))}get(t,s){let e=t;for(const t of s.split("."))if(!(e=e[t]))return null;return e}}const a=320,r=64,o=30,c=new Array(256).fill(0).map((t,s)=>s/256).map(t=>Math.asin(2*t-1)/Math.PI+.5).map(t=>(26-Math.ceil(1.5))*t),h="svg",u="defs",d="feGaussianBlur",p="femerge",m="femergenode",f="path";class g{constructor(t){this.$audio=t,this.createSVG()}play(){this.analyser||this.init(),this.render()}stop(){cancelAnimationFrame(this.frame)}init(){const t=new AudioContext,s=t.createMediaElementSource(this.$audio),e=t.createAnalyser();this.analyser=e,s.connect(e),e.connect(t.destination),e.fftSize=r;const i=e.frequencyBinCount;this.count=i-4,this.data=new Uint8Array(i),this.step=a/this.count}createSVG(){const t=l(h,null,{class:"visualization",viewBox:"0 0 320 60"}),s=l(u,t),e=l("filter",s,{id:"glow"});l(d,e,{class:"blur",result:"coloredBlur",stdDeviation:"4"});const i=l(p,e);for(let t=0;t<3;t++)l(m,i,{in:"coloredBlur"});l(m,i,{in:"SourceGraphic"});const n={fill:"transparent","stroke-width":"1.5","stroke-linecap":"square","stroke-linejoin":"arcs"};this.pathGlow=l(f,t,Object.assign({filter:"url(#glow)",class:"path-glow"},n)),this.path=l(f,t,Object.assign({class:"path"},n)),this.container=t}render(){this.frame=requestAnimationFrame(this.render.bind(this)),this.analyser.getByteFrequencyData(this.data),console.log(this.data.length,this.data);const t=[`M0,${o}`];let s=1;for(let e=0;e<2*this.count;e++){const i=this.getIndex(e,this.count);s*=-1,t.push(`L${(e+.5)*this.step/2},${o+s*c[this.data[i]]}`)}const e=t.join(" ");this.path.setAttribute("d",e),this.pathGlow.setAttribute("d",e)}getIndex(t,s){const e=s-t;return Math.abs(e-((Math.sign(e)+1)/2|0))}}const $="list",w="active",b="station",y="titles",T="title",v="subtitle",k="audio",A="ul",j="li",C="a",L="span";class M{constructor(t,s){this.$current=null,this.url=null,this.titleLoader=new n,this.titles=new Map,this.$audio=i(k,t,{crossorigin:"anonymous"});const e=i(A,t,{class:$});s.forEach(t=>e.appendChild(this.createItem(t))),this.visualizer=new g(this.$audio),this.$background=this.visualizer.container}createItem(t){const s=i(j),e=i(C,s),l=i(L,e,{class:b}),n=i(L,e,{class:y}),a=i(L,n,{class:T}),r=i(L,n,{class:v});return l.textContent=t.name,this.titles.set(t.url,{$title:a,$subtitle:r}),e.addEventListener("click",()=>this.onClick(s,t)),s}onClick(t,{url:s,title:e}){if(!s)return;const i=s!==this.url;this.stop(),i&&this.play(t,s,e)}stop(){this.$current&&(this.visualizer.stop(),this.$current.classList.remove(w),this.$current=null,this.url=null,this.$audio.pause(),this.unloadTitle())}play(t,s,e){t.prepend(this.$background),this.visualizer.play();const i=this.$audio;t.classList.add(w),this.$current=t,this.url=s,i.src=this.url,i.load(),i.play(),e&&this.loadTitle(s,e)}unloadTitle(){this.titleTimer&&(clearTimeout(this.titleTimer),this.titleTimer=null)}loadTitle(t,s){let e=this.titleTimer;this.titleLoader.load(s).then(i=>{if(e&&e!==this.titleTimer)return;const{$title:l,$subtitle:n}=this.titles.get(t);i=i||{title:null,subtitle:null},this.setTitle(l,i.title),this.setTitle(n,i.subtitle),this.titleTimer=e=setTimeout(()=>this.loadTitle(t,s),5e3)})}setTitle(t,s){s?t.classList.add(w):t.classList.remove(w),t.textContent=s}}(async()=>{const t=await fetch("data.json"),s=await t.json();new M(e.body,s.stations)})()}();