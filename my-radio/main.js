!function(){"use strict";const t=document,s=(s,i=null,a=null)=>{const e=t.createElement(s);return((t,s)=>{t&&Object.keys(t).forEach(i=>s.setAttribute(i,`${t[i]}`))})(a,e),((t,s)=>{s&&s.appendChild(t)})(e,i),e},i=(t,s)=>{let i=t;for(const t of s.split("."))if(!(i=i[t]))return null;return i},a=t=>s=>{if(!s)return null;let a=i(s,t.artist),e=i(s,t.song);if(!a||!e){const n=i(s,t.alt),h=(n||"").split(" - ");[a,e]=2===h.length?h:[n,null]}return{artist:a,song:e}};class e{constructor(){this.onLoad=(t=>this.onLoadAction=t),this.get=(t=>fetch(t.url).then(t=>t.json()).then(a(t)).catch(t=>null))}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}async start(t){this.stop(),await this.load(t)}async load(t){let s=this.timer;const i=await this.get(t)||{artist:null,song:null};s&&s!==this.timer||(this.onLoadAction(i,t.url),this.timer=s=setTimeout(()=>this.load(t),4e3))}}const n="player_state_changed",h="player_metadata_changed";class o{constructor(t,s,i){this.audioElement=t,this.stations=s,this.metadataLoader=i,this.current=0,this.playing=!1,this.metadata={},this.metadataMap={},this.onStateChanged=(t=>this.subscribe(n,t)),this.onMetadataChanged=(t=>this.subscribe(h,t)),t.addEventListener("pause",()=>this.pauseInternal()),t.addEventListener("play",()=>this.playInternal()),s.map((t,s)=>{t.title&&(this.metadataMap[t.title.url]=s)}),i.onLoad((t,s)=>this.updateMetadata(t,s))}play(t){this.playing&&this.audioElement.pause(),this.current!==t&&(this.audioElement.src=this.stations[t].url,this.current=t),this.audioElement.load(),this.audioElement.play()}stop(){this.audioElement.pause()}toggle(t){this.playing&&this.current===t?this.stop():this.play(t)}playInternal(){this.playing=!0;const t=this.stations[this.current].title;t?this.metadataLoader.start(t):this.metadataLoader.stop(),this.notice(n,{current:this.current,playing:this.playing})}pauseInternal(){this.playing=!1,this.metadataLoader.stop(),this.notice(n,{current:this.current,playing:this.playing})}updateMetadata(t,s){const i=Object.assign({},this.metadata);i[this.metadataMap[s]]=t,this.metadata=i,this.notice(h,this.metadata)}subscribe(t,s){this.audioElement.addEventListener(t,t=>s(t.detail))}notice(t,s=null){const i=new CustomEvent(t,{detail:s});this.audioElement.dispatchEvent(i)}}const l="list",r="active",c="station",d="title",u="song",p="artist",m="audio",g="ul",y="li",E="a",w="span";class L{constructor(t){this.audio=s(m,null,{crossorigin:"anonymous"}),this.list=s(g,null,{class:l}),this.ids=[],this.items={},this.meta={},this.onItemClick=(()=>{}),t.forEach((t,s)=>this.list.appendChild(this.createItem(t,s)))}render(t){t.appendChild(this.audio),t.appendChild(this.list)}onToggle(t){this.onItemClick=t}setState({current:t,playing:s}){this.ids.forEach(i=>{const a=this.items[i];s&&t===i?a.classList.add(r):a.classList.remove(r)})}setMetadata(t){this.ids.forEach(s=>{const i=t[s]||{},a=this.meta[s];this.setMeta(a.song,i.song),this.setMeta(a.artist,i.artist)})}setMeta(t,s){s?t.classList.add(r):t.classList.remove(r),t.textContent=s}createItem(t,i){const a=s(y),e=s(E,a),n=s(w,e,{class:c}),h=s(w,e,{class:d}),o=s(w,h,{class:u}),l=s(w,h,{class:p});return n.textContent=t.name,this.ids.push(i),this.items[i]=a,this.meta[i]={song:o,artist:l},e.addEventListener("click",()=>this.onItemClick(i)),a}}class v{constructor(t,s){this.container=t,this.stations=s,this.view=new L(s);const i=new e;this.player=new o(this.view.audio,s,i)}init(){this.view.render(this.container),this.view.onToggle(t=>this.player.toggle(t)),this.player.onStateChanged(t=>this.view.setState(t)),this.player.onMetadataChanged(t=>this.view.setMetadata(t))}}(async()=>{const{stations:s}=await(async()=>{const t=await fetch("data.json");return await t.json()})();new v(t.body,s).init()})()}();