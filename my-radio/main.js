!function(){"use strict";const t=(t,e)=>{t&&Object.keys(t).forEach(s=>e.setAttribute(s,`${t[s]}`))},e=(t,e)=>{e&&e.appendChild(t)},s=document,i=(i,l=null,n=null)=>{const a=s.createElement(i);return t(n,a),e(a,l),a},l=(i,l=null,n=null)=>{const a=s.createElementNS("http://www.w3.org/2000/svg",i);return t(n,a),e(a,l),a};class n{constructor(){this.load=(({url:t,artist:e,song:s,alt:i})=>fetch(t).then(t=>t.json()).then(t=>{if(!t)return null;let l=this.get(t,e),n=this.get(t,s);if(!l||!n){const e=this.get(t,i),s=(e||"").split(" - ");[l,n]=2===s.length?s:[e,null]}return{title:l,subtitle:n}}).catch(t=>null))}get(t,e){let s=t;for(const t of e.split("."))if(!(s=s[t]))return null;return s}}const a=320,r=64,o=30,c=new Array(256).fill(0).map((t,e)=>e/256).map(t=>Math.asin(2*t-1)/Math.PI+.5).map(t=>(26-Math.ceil(1.5))*t),h="svg",u="defs",d="feGaussianBlur",p="femerge",m="femergenode",f="path";class g{constructor(t){this.$audio=t,this.createSVG()}play(){this.analyser||this.init(),this.render()}stop(){cancelAnimationFrame(this.frame)}init(){const t=new AudioContext,e=t.createMediaElementSource(this.$audio),s=t.createAnalyser();this.analyser=s,e.connect(s),s.connect(t.destination),s.fftSize=r;const i=s.frequencyBinCount;this.count=i-4,this.data=new Uint8Array(i),this.step=a/this.count}createSVG(){const t=l(h,null,{class:"visualization",viewBox:"0 0 320 60"}),e=l(u,t),s=l("filter",e,{id:"glow"});l(d,s,{class:"blur",result:"coloredBlur",stdDeviation:"4"});const i=l(p,s);for(let t=0;t<3;t++)l(m,i,{in:"coloredBlur"});l(m,i,{in:"SourceGraphic"});const n={fill:"transparent","stroke-width":"1.5","stroke-linecap":"square","stroke-linejoin":"arcs"};this.pathGlow=l(f,t,Object.assign({filter:"url(#glow)",class:"path-glow"},n)),this.path=l(f,t,Object.assign({class:"path"},n)),this.container=t}render(){this.frame=requestAnimationFrame(this.render.bind(this)),this.analyser.getByteFrequencyData(this.data);const t=[`M0,${o}`];let e=1;for(let s=0;s<2*this.count;s++){const i=this.getIndex(s,this.count);e*=-1,t.push(`L${(s+.5)*this.step/2},${o+e*c[this.data[i]]}`)}const s=t.join(" ");this.path.setAttribute("d",s),this.pathGlow.setAttribute("d",s)}getIndex(t,e){const s=e-t;return Math.abs(s-((Math.sign(s)+1)/2|0))}}const $="list",w="active",b="station",y="titles",T="title",v="subtitle",k="audio",A="ul",j="li",C="a",L="span";class M{constructor(t,e){this.$current=null,this.url=null,this.titleLoader=new n,this.titles=new Map,this.$audio=i(k,t,{crossorigin:"anonymous"});const s=i(A,t,{class:$});e.forEach(t=>s.appendChild(this.createItem(t))),this.visualizer=new g(this.$audio),this.$background=this.visualizer.container}createItem(t){const e=i(j),s=i(C,e),l=i(L,s,{class:b}),n=i(L,s,{class:y}),a=i(L,n,{class:T}),r=i(L,n,{class:v});return l.textContent=t.name,this.titles.set(t.url,{$title:a,$subtitle:r}),s.addEventListener("click",()=>this.onClick(e,t)),e}onClick(t,{url:e,title:s}){if(!e)return;const i=e!==this.url;this.stop(),i&&this.play(t,e,s)}stop(){this.$current&&(this.visualizer.stop(),this.$current.classList.remove(w),this.$current=null,this.url=null,this.$audio.pause(),this.unloadTitle())}play(t,e,s){t.prepend(this.$background),this.visualizer.play();const i=this.$audio;t.classList.add(w),this.$current=t,this.url=e,i.src=this.url,i.load(),i.play(),s&&this.loadTitle(e,s)}unloadTitle(){this.titleTimer&&(clearTimeout(this.titleTimer),this.titleTimer=null)}loadTitle(t,e){let s=this.titleTimer;this.titleLoader.load(e).then(i=>{if(s&&s!==this.titleTimer)return;const{$title:l,$subtitle:n}=this.titles.get(t);i=i||{title:null,subtitle:null},this.setTitle(l,i.title),this.setTitle(n,i.subtitle),this.titleTimer=s=setTimeout(()=>this.loadTitle(t,e),5e3)})}setTitle(t,e){e?t.classList.add(w):t.classList.remove(w),t.textContent=e}}(async()=>{const t=await fetch("data.json"),e=await t.json();new M(s.body,e.stations)})()}();